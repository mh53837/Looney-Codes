import{r as n,U,S as a,M as $,V as K,R as B}from"./index-f65cf5b0.js";import{m as H}from"./NewProblem-cedc8bd7.js";import{d as J,a as M,D as N}from"./hr-2cfbac23.js";import{A as _}from"./AddProblemsToCompetition-a62b4633.js";/* empty css                              */const X=({handleOk:f})=>{const u=J(),[m,h]=n.useState(null),[x,k]=n.useState(!1),{user:l}=n.useContext(U),[g,i]=n.useState(""),[S,v]=n.useState(""),[P,b]=n.useState(null),[C,w]=n.useState(null),[p,y]=n.useState({natjecanjeId:0,mjesto:1,slikaPehara:null}),[z,D]=H.useMessage(),[s,c]=n.useState({nazivNatjecanja:"",pocetakNatjecanja:"",krajNatjecanja:""});function I(e){const{name:t,value:r}=e.target;c(j=>({...j,[t]:r}))}const T=e=>{b(e),e&&c(t=>({...t,pocetakNatjecanja:e.toISOString()}))};function F(e){if(e.target.files&&e.target.files.length>0){const t=e.target.files[0];y(r=>({...r,slikaPehara:t}))}}const R=e=>{if(p.slikaPehara){const t=new FormData,r={natjecanjeId:e,mjesto:1};t.append("image",p.slikaPehara,p.slikaPehara.name),t.append("peharData",new Blob([JSON.stringify(r)],{type:"application/json"}),"peharData.json"),fetch("/api/trophies/add",{method:"POST",body:t}).then(o=>{o.ok?console.log("uspjesno prenesena slika pehara!"):(console.log(o),i("Došlo je do pogreške, pokušajte ponovno!"))})}},O=e=>{c({nazivNatjecanja:"",pocetakNatjecanja:"",krajNatjecanja:""}),v(""),i(""),h(e),k(!0)},V=()=>{k(!1),h(null),f()},A=e=>{w(e),e&&c(t=>({...t,krajNatjecanja:e.toISOString()}))},E=async e=>{if(e.preventDefault(),i(""),s.nazivNatjecanja===""||s.pocetakNatjecanja===""||s.krajNatjecanja===""){i("unesite potrebne podatke i pokušajte ponovno");return}const t={nazivNatjecanja:s.nazivNatjecanja,pocetakNatjecanja:s.pocetakNatjecanja,krajNatjecanja:s.krajNatjecanja,korisnickoImeVoditelja:l.korisnickoIme},j={method:"POST",headers:{Authorization:`Basic ${btoa(`${l.korisnickoIme}:${l.lozinka}`)}`,"Content-Type":"application/json"},body:JSON.stringify(t)};try{const o=await fetch("/api/natjecanja/new",j);if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const d=await o.json();R(d.natjecanjeId),z.open({type:"success",content:"uspješno ste kreirali novo natjecanje"}),v("uspješno ste kreirali novo natjecanje"),O(d.natjecanjeId),console.log("Server response:",d)}catch(o){console.error("Fetch error:",o),i("Došlo je do pogreške, pokušajte ponovno!")}};return a.jsxs("div",{className:"newProblem-container",children:[D,a.jsx("div",{className:"NewProblem",children:a.jsxs("form",{onSubmit:E,children:[a.jsxs("div",{className:"FormRow",children:[a.jsx("label",{children:"naziv natjecanja"}),a.jsx("input",{name:"nazivNatjecanja",placeholder:"naziv natjecanja",onChange:I,value:s.nazivNatjecanja})]}),a.jsx($,{locale:M,children:a.jsxs(K,{direction:"vertical",children:[a.jsxs("div",{className:"FormRowDate",children:[a.jsx("label",{children:"početak natjecanja "}),a.jsx(N,{showTime:!0,placeholder:"početak natjecanja",defaultValue:u,value:P,onChange:T,size:"small"})]}),a.jsxs("div",{className:"FormRowDate",children:[a.jsx("label",{children:" kraj natjecanja"}),a.jsx(N,{showTime:!0,placeholder:"kraj natjecanja",defaultValue:u,value:C,onChange:A,size:"small"})]})]})}),a.jsxs("div",{className:"FormRow",children:[a.jsx("label",{children:"slika pehara"}),a.jsx("input",{name:"slikaPehara",type:"file",onChange:F,accept:".jpg, .jpeg, .png",className:"fileInput"})]}),a.jsx("div",{className:"error",children:g}),a.jsx("div",{className:"poruka",children:S}),a.jsx("button",{type:"submit",children:"stvori natjecanje!"})]})}),x&&m!==null&&a.jsx(B.Suspense,{fallback:a.jsx("div",{children:"učitavanje..."}),children:a.jsx(_,{natjecanjeId:m,visible:!0,onClose:V})})]})};export{X as default};
