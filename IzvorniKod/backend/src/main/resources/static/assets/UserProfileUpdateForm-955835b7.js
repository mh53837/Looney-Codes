import{R as E,a as _,r as t,U as B,j as e}from"./index-b0686eb3.js";/* empty css                              */import{q as M}from"./index-1172dc73.js";const V=E.lazy(()=>_(()=>import("./index-8487c0ad.js").then(c=>c.i),["assets/index-8487c0ad.js","assets/interopRequireDefault-01ffd8a5.js","assets/index-b0686eb3.js","assets/index-f52ba512.css","assets/index-1172dc73.js","assets/DialogWrap-6ec0a3f8.js","assets/index-746205fb.js"])),G=({korisnickoIme:c,onUpdateSuccess:N})=>{const[r,w]=t.useState(null),{user:h}=t.useContext(B),[T,j]=t.useState(!1),[P,f]=t.useState(!1),[k,x]=t.useState(""),[v,z]=t.useState(""),[y,C]=t.useState(""),[n,i]=t.useState(""),[U,l]=t.useState(""),[g,b]=t.useState(""),[S,R]=t.useState(null),[F,d]=t.useState(""),L=a=>{b(a.target.value)},O=a=>{if(a.target.files&&a.target.files.length>0){const o=a.target.files[0];R(o)}},A=()=>{if(d(""),n===""&&U==="")return i(""),l(""),!0;if(n!==U)return i(""),l(""),d("Lozinke se ne podudaraju!"),!1;const a=8,o=/[A-Z]/.test(n),s=/[a-z]/.test(n),p=/\d/.test(n),u=/[!@#$%^&*(),.?":{}|<>]/.test(n);return n.length<a?(i(""),l(""),d("Lozinka mora sadržavati barem 8 znakova!"),!1):!o||!s||!p||!u?(i(""),l(""),d("Lozinka mora sadržavati barem jedno veliko slovo, interpunkcijski znak i broj!"),!1):!0};t.useEffect(()=>{(async()=>{try{const s=await(await fetch(`/api/user/profile/${c}`)).json();w(s),x(s.ime),z(s.prezime),C(s.email),b(s.uloga)}catch(o){console.error("Error fetching initial data:",o)}})()},[c]);const $=()=>{j(!0)},D=async()=>{f(!0);try{A()?(d(""),await I(c),j(!1),f(!1),N()):f(!1)}catch(a){console.error("Error handling edit:",a),f(!1)}},J=()=>{console.log("Clicked cancel button"),j(!1),d(""),x((r==null?void 0:r.ime)||""),z((r==null?void 0:r.prezime)||""),C((r==null?void 0:r.email)||""),i(""),l(""),b("")},I=async a=>{try{console.log(`credentials:${h.korisnickoIme} : ${h.lozinka}`);const o=btoa(`${h.korisnickoIme}:${h.lozinka}`),s={...k!==""&&{ime:k},...v!==""&&{prezime:v},...y!==""&&{email:y},...g!==""&&{requestedUloga:g},...n!==""&&{lozinka:n}};let p;if(S){const m=new FormData;m.append("image",S,S.name),m.append("userData",new Blob([JSON.stringify(s)],{type:"application/json"}),"userData.json"),p={method:"POST",headers:{Authorization:`Basic ${o}`},body:m}}else p={method:"POST",headers:{Authorization:`Basic ${o}`,"Content-Type":"application/json"},body:JSON.stringify(s)};console.log("updated data:",s);const u=await fetch(`/api/user/update/${a}`,p);if(u.ok){console.log(`successfully updated korisnik data for: ${a}`);const m=await u.json();console.log("API Response:",m)}else console.error("failed to update korisnik data:",u.statusText)}catch(o){console.error("error updating korisnik data:",o)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:$,children:"uredi korisničke podatke"}),e.jsx(M,{theme:{components:{Modal:{},Button:{colorPrimary:"#dd7230",colorPrimaryHover:"#dd723081",colorPrimaryActive:"#dd723081"}}},children:e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"učitavanje..."}),children:e.jsx(V,{title:"uredi korisničke podatke",open:T,onOk:D,confirmLoading:P,onCancel:J,cancelText:"odustani",okText:"spremi promjene",children:e.jsxs("div",{className:"updateFormContainer",children:[e.jsx("p",{children:"ime:"}),e.jsx("input",{className:"problemUpdateForm",type:"text",placeholder:"ime",value:k,onChange:a=>x(a.target.value)}),e.jsx("p",{children:"prezime:"}),e.jsx("input",{className:"problemUpdateForm",type:"text",placeholder:"prezime",value:v,onChange:a=>z(a.target.value)}),e.jsx("p",{children:"email:"}),e.jsx("input",{className:"problemUpdateForm",type:"text",placeholder:"email",value:y,onChange:a=>C(a.target.value)}),e.jsx("p",{children:"nova lozinka:"}),e.jsx("input",{className:"problemUpdateForm",type:"password",placeholder:"nova lozinka",value:n,onChange:a=>i(a.target.value)}),e.jsx("p",{children:"potvrdi novu lozinku:"}),e.jsx("input",{className:"problemUpdateForm",type:"password",placeholder:"nova lozinka",value:U,onChange:a=>l(a.target.value)}),e.jsxs("div",{className:"FormRow",children:[e.jsx("label",{children:"slika profila"}),e.jsx("input",{name:"slika",type:"file",onChange:O,accept:".jpg, .jpeg, .png"})]}),e.jsxs("div",{className:"FormRow",children:[e.jsx("p",{children:"uloga: "}),e.jsxs("div",{className:"RoleOptions",children:[e.jsxs("label",{className:"RadioLbl",children:[e.jsx("input",{type:"radio",value:"VODITELJ",checked:g==="VODITELJ",onChange:L}),"voditelj"]}),e.jsxs("label",{className:"RadioLbl",children:[e.jsx("input",{type:"radio",value:"NATJECATELJ",checked:g==="NATJECATELJ",onChange:L}),"natjecatelj"]})]})]}),e.jsx("div",{className:"error",children:F})]})})})})]})};export{G as default};
