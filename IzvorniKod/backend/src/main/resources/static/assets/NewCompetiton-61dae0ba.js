import{r as s,U,S as a,M as $,V as K,R as B,W as H}from"./index-c885bd5f.js";import{m as J}from"./NewProblem-0d36379d.js";import{d as M,a as W,D as N}from"./hr-bd934e82.js";const L=({handleOk:v})=>{const u=M(),[h,m]=s.useState(null),[f,k]=s.useState(!1),{user:j}=s.useContext(U),[x,c]=s.useState(""),[S,g]=s.useState(""),[P,b]=s.useState(null),[w,C]=s.useState(null),[p,y]=s.useState({natjecanjeId:0,mjesto:0,slikaPehara:null}),[z,D]=J.useMessage(),[n,i]=s.useState({nazivNatjecanja:"",pocetakNatjecanja:"",krajNatjecanja:""});function T(e){const{name:o,value:t}=e.target;i(l=>({...l,[o]:t}))}const I=(e,o)=>{console.log(e,o),b(e),e&&(i(t=>({...t,pocetakNatjecanja:e.toISOString()})),console.log(n.pocetakNatjecanja))};function F(e){if(e.target.files&&e.target.files.length>0){const o=e.target.files[0];y(t=>({...t,slikaPehara:o}))}}const R=e=>{if(p.slikaPehara){const o=new FormData,t={natjecanjeId:e,mjesto:0};o.append("image",p.slikaPehara,p.slikaPehara.name),o.append("peharData",new Blob([JSON.stringify(t)],{type:"application/json"}),"peharData.json"),fetch("/api/trophies/add",{method:"POST",body:o}).then(r=>{r.ok?console.log("uspjesno prenesena slika pehara!"):(console.log(r),console.log("pogreška!"),c("Došlo je do pogreške, pokušajte ponovno!"))})}},O=e=>{i({nazivNatjecanja:"",pocetakNatjecanja:"",krajNatjecanja:""}),g(""),c(""),console.log("new competition id:",e),m(e),k(!0)},V=()=>{k(!1),m(null),v()},E=(e,o)=>{console.log(e,o),C(e),e&&(i(t=>({...t,krajNatjecanja:e.toISOString()})),console.log(n.krajNatjecanja))},A=async e=>{if(e.preventDefault(),c(""),n.nazivNatjecanja===""||n.pocetakNatjecanja===""||n.krajNatjecanja===""){c("unesite potrebne podatke i pokušajte ponovno");return}const o={nazivNatjecanja:n.nazivNatjecanja,pocetakNatjecanja:n.pocetakNatjecanja,krajNatjecanja:n.krajNatjecanja,korisnickoImeVoditelja:j.korisnickoIme},l={method:"POST",headers:{Authorization:`Basic ${btoa(`${j.korisnickoIme}:${j.lozinka}`)}`,"Content-Type":"application/json"},body:JSON.stringify(o)};try{const r=await fetch("/api/natjecanja/new",l);if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);const d=await r.json();R(d.natjecanjeId),z.open({type:"success",content:"uspješno ste kreirali novo natjecanje"}),g("uspješno ste kreirali novo natjecanje"),O(d.natjecanjeId),console.log("Server response:",d)}catch(r){console.error("Fetch error:",r),c("Došlo je do pogreške, pokušajte ponovno!")}};return a.jsxs("div",{className:"newProblem-container",children:[D,a.jsx("div",{className:"NewProblem",children:a.jsxs("form",{onSubmit:A,children:[a.jsxs("div",{className:"FormRow",children:[a.jsx("label",{children:"naziv natjecanja"}),a.jsx("input",{name:"nazivNatjecanja",placeholder:"naziv natjecanja",onChange:T,value:n.nazivNatjecanja})]}),a.jsx($,{locale:W,children:a.jsxs(K,{direction:"vertical",children:[a.jsxs("div",{className:"FormRowDate",children:[a.jsx("label",{children:"početak natjecanja "}),a.jsx(N,{showTime:!0,placeholder:"početak natjecanja",defaultValue:u,value:P,onChange:I,size:"small"})]}),a.jsxs("div",{className:"FormRowDate",children:[a.jsx("label",{children:" kraj natjecanja"}),a.jsx(N,{showTime:!0,placeholder:"kraj natjecanja",defaultValue:u,value:w,onChange:E,size:"small"})]})]})}),a.jsxs("div",{className:"FormRow",children:[a.jsx("label",{children:"slika pehara"}),a.jsx("input",{name:"slikaPehara",type:"file",onChange:F,accept:".jpg, .jpeg, .png"})]}),a.jsx("div",{className:"error",children:x}),a.jsx("div",{className:"poruka",children:S}),a.jsx("button",{type:"submit",children:"stvori natjecanje!"})]})}),f&&h!==null&&a.jsx(B.Suspense,{fallback:a.jsx("div",{children:"učitavanje..."}),children:a.jsx(H,{natjecanjeId:h,visible:!0,onClose:V})})]})};export{L as default};
